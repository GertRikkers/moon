/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,i=["NaN","event","false","in","null","this","true","typeof","undefined"],l=function(e){var n=!1;return{expression:e=e.replace(t,function(e,t){return void 0===t||-1!==i.indexOf(t)?e:(n=!0,"$"===t[0]?"locals."+t:"instance."+t)}),dynamic:n}},e={silent:!0},v=/^\s+$/,d=/[\s/>]/,c=function(e,t,n,i){for(;e<n;){var r=t[e];if("/"===r||">"===r)break;if(v.test(r))e+=1;else{for(var o="",a=void 0,u=!1;e<n;){if("/"===(r=t[e])||">"===r||v.test(r)){a="";break}if("="===r){e+=1;break}o+=r,e+=1}if(void 0===a){var s=void 0;for(a="",'"'===(r=t[e])||"'"===r?(s=r,e+=1):"{"===r?(s="}",u=!0,e+=1):s=d;e<n;){if(r=t[e],"object"==typeof s&&s.test(r)||r===s){e+=1;break}a+=r,e+=1}}var f=!1;if(u){var c=l(a);a=c.expression,f=c.dynamic}i.push({key:o,value:a,expression:u,dynamic:f})}}return e},a=function(e,t,n,i){for(var r={type:"",attributes:[],children:[]};e<n;){var o=t[e];if("/"===o||">"===o){var a=r.attributes,u=i.length-1;"/"===o?e+=1:i.push(r);for(var s=0;s<a.length;){var f=a[s];"#"===f.key[0]?(r={type:f.key,attributes:[{key:"",value:f.value,expression:f.expression,dynamic:f.dynamic}],children:[r]},a.splice(s,1)):s+=1}i[u].children.push(r),e+=1;break}v.test(o)&&(e+=1)||"="===o?e=c(e,t,n,r.attributes):(r.type+=o,e+=1)}return e},u=function(e,t,n,i){for(;e<n;e++){var r=t[e];if(">"===r){e+=1;break}r}var o=i.pop();return o.type,e},s=function(e,t,n){for(;e<n;){var i=t[e],r=t[e+1],o=t[e+2];if("<"===i&&"!"===r&&"-"===o&&"-"===t[e+3])e=s(e+4,t,n);else{if("-"===i&&"-"===r&&">"===o){e+=3;break}e+=1}}return e},f=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,m={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},h=function(e,t,n,i){for(var r="";e<n;e++){var o=t[e];if("<"===o||"{"===o)break;r+=o}return v.test(r)||i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:r.replace(f,function(e){return m[e]}),expression:!1,dynamic:!1}],children:[]}),e},p=function(e,t,n,i){for(var r="";e<n;e++){var o=t[e];if("}"===o){e+=1;break}r+=o}var a=l(r);return i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:a.expression,expression:!0,dynamic:a.dynamic}],children:[]}),e},X=function(e){return"m"+e},Y=function(e,t){return X(e)+"="+t},ee=function(e){return e.expression?e.value:'"'+e.value+'"'},te=function(e,t){return"m.rc("+X(e)+","+X(t)+");"},ne=function(e,t,n,i,r,o,a){return"m.df("+e+","+t+","+X(n)+","+X(i)+","+X(r)+","+X(o)+","+X(a)+");"},ie=function(e,t,n){return void 0===n?(o=t,"m.ac("+X(e)+","+X(o)+");"):(i=n,r=t,"m.ib("+X(e)+","+X(i)+","+X(r)+");");var i,r,o},re=function(e,t,n,i){switch(e.type){case"#if":e.ifState=n.nextElement++,e.ifReference=n.nextElement++;for(var r=n.nextElement++,o=n.nextElement++,a="[",u="[",s="",f=t.children,c=f.indexOf(e);c<f.length;c++){var l=f[c];if("#if"!==l.type&&"#elseif"!==l.type&&"#else"!==l.type)break;a+=s+("#else"===l.type?"true":ee(l.attributes[0])),u+=s+"function(locals){"+oe({element:n.nextElement,nextElement:n.nextElement+1,type:"#root",attributes:[],children:l.children},e.ifReference)+"}({})",s=","}return[Y(e.ifReference,"m.cc();")+ie(e.ifReference,t.element,i)+Y(o,u+"];"),Y(r,a+"];")+Y(e.ifState,(K=e.ifState,P=e.ifReference,Q=r,V=o,W=t.element,"m.di("+X(K)+","+X(P)+","+X(Q)+","+X(V)+","+X(W)+");")),X(e.ifState)+"[2]();"];case"#elseif":case"#else":return["","",""];case"#for":for(var v=ee(e.attributes[0]),d="[",m="",h=n.nextElement++,p=n.nextElement++,y=n.nextElement++,b=n.nextElement++,x="",g="",_=0;_<v.length;_++){var k=v[_];","===k||" "===k&&"i"===v[_+1]&&"n"===v[_+2]&&" "===v[_+3]&&(_+=3)?(d+=g+'"'+x.substring(7)+'"',x="",g=","):x+=k}return d+="]",m+=x,[Y(h,"m.cc();")+ie(h,t.element,i)+Y(p,"function(locals){"+oe({element:n.nextElement,nextElement:n.nextElement+1,type:"#root",attributes:[],children:e.children},h)+"};")+Y(y,"[];")+Y(b,"[];"),ne(d,m,h,p,y,b,t.element),ne(d,"[]",h,p,y,b,t.element)];case"#text":var E=e.attributes[0],w=n.nextElement++,$=(I=w,J=ee(E),"m.stc("+X(I)+","+J+");"),q=Y(w,"m.ctn("+'""'+");"),C="";return E.dynamic?C+=$:q+=$,[q+ie(w,t.element,i),C,te(w,t.element)];default:var A=e.attributes,R=e.children;e.element=n.nextElement++;for(var S=Y(e.element,'m.ce("'+e.type+'");'),z="",Z=0;Z<A.length;Z++){var D=A[Z],N=void 0;if("@"===D.key[0]){var O=void 0,U=void 0;if("@bind"===D.key){var j=ee(D);N=X(e.element)+".value="+j+";",O="input",U=j+"=$event.target.value;instance.update();"}else N="",O=D.key.substring(1),U="locals.$event=$event;"+ee(D)+";";S+=(M=e.element,G=O,H="function($event){"+U+"}","m.ael("+X(M)+',"'+G+'",'+H+");")}else F=e.element,L=D,N="m.sa("+X(F)+',"'+L.key+'",'+ee(L)+");";D.dynamic?z+=N:S+=N}for(var T=0;T<R.length;T++){var B=re(R[T],e,n);S+=B[0],z+=B[1]}return[S+ie(e.element,t.element,i),z,te(e.element,t.element)]}var F,L,M,G,H,I,J,K,P,Q,V,W},oe=function(e,t){for(var n=e.children,i="",r="",o="",a=0;a<n.length;a++){var u=re(n[a],e,e,t);i+=u[0],r+=u[1],o+=u[2]}for(var s="var m"+e.element,f=e.element+1;f<e.nextElement;f++)s+=",m"+f;return s+";return [function($_){"+Y(e.element,"$_;")+i+"},function(){"+r+"},function(){"+o+"}];"},o=function(e){return oe(function(e){for(var t=e.length,n={element:0,nextElement:1,type:"#root",attributes:[],children:[]},i=[n],r=0;r<t;){var o=e[r];r="<"===o?"!"===e[r+1]&&"-"===e[r+2]&&"-"===e[r+3]?s(r+4,e,t):"/"===e[r+1]?u(r+2,e,t,i):a(r+1,e,t,i):"{"===o?p(r+1,e,t,i):h(r,e,t,i)}return n}(e))},y={ce:function(e){return document.createElement(e)},ctn:function(e){return document.createTextNode(e)},cc:function(){return document.createComment("")},sa:function(e,t,n){e.setAttribute(t,n)},ael:function(e,t,n){e.addEventListener(t,n)},stc:function(e,t){e.textContent=t},ac:function(e,t){t.appendChild(e)},rc:function(e,t){t.removeChild(e)},ib:function(e,t,n){n.insertBefore(e,t)},di:function(e,t,n,i,r){for(var o=0;o<n.length;o++)if(n[o]){var a=i[o];return e===a?a[1]():(e&&e[2](),a[0](r),a[1](),e=a),e}},df:function(e,t,n,i,r,o,a){for(var u=r.length,s=t.length,f=s<u?u:s,c=e[1],l=e[0],v=0;v<f;v++)if(u<=v){var d={};d[c]=v,d[l]=t[v];var m=i(o[v]=d);r.push(m),m[0](a),m[1]()}else if(s<=v)r.pop()[2]();else{var h=o[v];h[c]=v,h[l]=t[v],r[v][1]()}}},b=function(e){this._view[0](e),this.emit("create")},x=function(e,t){if(void 0!==e)if("object"==typeof e)for(var n in e)this[n]=e[n];else this[e]=t;if(!1===this._queued){this._queued=!0;var i=this;setTimeout(function(){i._view[1](),i._queued=!1,i.emit("update")},0)}},g=function(){this._view[2](),this.emit("destroy")},_=function(e,t){var n=this._events,i=n[e];void 0===i?n[e]=[t]:i.push(t)},k=function(e,t){if(void 0===e)this._events={};else if(void 0===t)this._events[e]=[];else{var n=this._events[e];n.splice(n.indexOf(t),1)}},E=function(e,t){var n=this._events[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var i=0;i<n.length;i++)n[i](t)},r=function(i,r){return function(){this._name=i,this._queued=!1,"string"==typeof r.view?this._view=new Function("m","instance","locals",o(r.view))(y,this,{}):this._view=r.view(y,this,{}),delete r.view;var e={};for(var t in void 0!==r.onCreate&&(e.create=r.onCreate.bind(this),delete r.onCreate),void 0!==r.onUpdate&&(e.update=r.onUpdate.bind(this),delete r.onUpdate),void 0!==r.onDestroy&&(e.destroy=r.onDestroy.bind(this),delete r.onDestroy),this._events=e,void 0===r?r={}:"function"==typeof r&&(r=r()),r){var n=r[t];this[t]="function"==typeof n?n.bind(this):n}this.create=b,this.update=x,this.destroy=g,this.on=_,this.off=k,this.emit=E}};function n(e){var t=e.root;delete e.root,"string"==typeof t&&(t=document.querySelector(t));var n=new(r("",e));return n.create(t),n.update(),n}return n.extend=function(e,t){},n.compile=o,n.config=e,n});