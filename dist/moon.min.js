/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,r=["NaN","event","false","in","null","this","true","typeof","undefined"],f=function(e){var n=!1;return{expression:e=e.replace(t,function(e,t){return void 0===t||-1!==r.indexOf(t)?e:(n=!0,"$"===t[0]?"locals."+t:"instance."+t)}),dynamic:n}},e={silent:!0},v=/^\s+$/,d=/[\s/>]/,m=function(e,t,n,r){for(;e<n;){var i=t[e];if("/"===i||">"===i)break;if(v.test(i))e+=1;else{for(var o="",a=void 0,u=!1;e<n;){if("/"===(i=t[e])||">"===i||v.test(i)){a="";break}if("="===i){e+=1;break}o+=i,e+=1}if(void 0===a){var s=void 0;for(a="",'"'===(i=t[e])||"'"===i?(s=i,e+=1):"{"===i?(s="}",u=!0,e+=1):s=d;e<n;){if(i=t[e],"object"==typeof s&&s.test(i)||i===s){e+=1;break}a+=i,e+=1}}var l=!1;if(u){var c=f(a);a=c.expression,l=c.dynamic}r.push({key:o,value:a,expression:u,dynamic:l})}}return e},a=function(e,t,n,r){for(var i,o={type:"",attributes:[],children:[]};e<n;){var a=t[e];if("/"===a||">"===a){var u=o.attributes,s=r.length-1;"/"===a?e+=1:r.push(o);for(var l=0;l<u.length;){var c=u[l];(i=c.key)[0]===i[0].toUpperCase()&&i[0]!==i[0].toLowerCase()?(o={type:c.key,attributes:[{key:"",value:c.value,expression:c.expression,dynamic:c.dynamic}],children:[o]},u.splice(l,1)):l+=1}r[s].children.push(o),e+=1;break}v.test(a)&&(e+=1)||"="===a?e=m(e,t,n,o.attributes):(o.type+=a,e+=1)}return e},u=function(e,t,n,r){for(;e<n;e++){var i=t[e];if(">"===i){e+=1;break}i}var o=r.pop();return o.type,e},s=function(e,t,n){for(;e<n;){var r=t[e],i=t[e+1],o=t[e+2];if("<"===r&&"!"===i&&"-"===o&&"-"===t[e+3])e=s(e+4,t,n);else{if("-"===r&&"-"===i&&">"===o){e+=3;break}e+=1}}return e},l=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,c={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},h=function(e,t,n,r){for(var i="";e<n;e++){var o=t[e];if("<"===o||"{"===o)break;i+=o}return v.test(i)||r[r.length-1].children.push({type:"Text",attributes:[{key:"",value:i.replace(l,function(e){return c[e]}),expression:!1,dynamic:!1}],children:[]}),e},p=function(e,t,n,r){for(var i="";e<n;e++){var o=t[e];if("}"===o){e+=1;break}i+=o}var a=f(i);return r[r.length-1].children.push({type:"Text",attributes:[{key:"",value:a.expression,expression:!0,dynamic:a.dynamic}],children:[]}),e},ee=function(e){return"m"+e},te=function(e,t){return ee(e)+"="+t},ne=function(e){return e.expression?e.value:'"'+e.value+'"'},re=function(e,t){return"m.rc("+ee(e)+","+ee(t)+");"},ie=function(e,t,n,r,i,o,a){return"m.df("+e+","+t+","+ee(n)+","+ee(r)+","+ee(i)+","+ee(o)+","+ee(a)+");"},oe=function(e,t,n){return null===n?(o=t,"m.ac("+ee(e)+","+ee(o)+");"):(r=n,i=t,"m.ib("+ee(e)+","+ee(r)+","+ee(i)+");");var r,i,o},ae=function(e,t,n,r){switch(e.type){case"If":for(var i=n.nextElement++,o=n.nextElement++,a=n.nextElement++,u=n.nextElement++,s="[",l="[",c="",f=t.children,v=f.indexOf(e);v<f.length;v++){var d=f[v];if("If"!==d.type&&"ElseIf"!==d.type&&"Else"!==d.type)break;s+=c+("Else"===d.type?"true":ne(d.attributes[0])),l+=c+"function(locals){"+ue({element:0,nextElement:1,type:"Root",attributes:[],children:d.children},o)+"}({})",c=","}return[te(o,"m.cc();")+oe(o,t.element,r)+te(u,l+"];"),te(a,s+"];")+te(i,(Q=i,V=o,W=a,X=u,Y=t.element,"m.di("+ee(Q)+","+ee(V)+","+ee(W)+","+ee(X)+","+ee(Y)+");")),ee(i)+"[2]();"];case"ElseIf":case"Else":return["","",""];case"For":for(var m=ne(e.attributes[0]),h="[",p="",y=n.nextElement++,b=n.nextElement++,x=n.nextElement++,g=n.nextElement++,E="",_="",k=0;k<m.length;k++){var w=m[k];","===w||" "===w&&"i"===m[k+1]&&"n"===m[k+2]&&" "===m[k+3]&&(k+=3)?(h+=_+'"'+E.substring(7)+'"',E="",_=","):E+=w}return h+="]",p+=E,[te(y,"m.cc();")+oe(y,t.element,r)+te(b,"function(locals){"+ue({element:0,nextElement:1,type:"Root",attributes:[],children:e.children},y)+"};")+te(x,"[];")+te(g,"[];"),ie(h,p,y,b,x,g,t.element),ie(h,"[]",y,b,x,g,t.element)];case"Text":var $=e.attributes[0],C=n.nextElement++,q=(K=C,P=ne($),"m.stc("+ee(K)+","+P+");"),A=te(C,"m.ctn("+'""'+");"),T="";return $.dynamic?T+=q:A+=q,[A+oe(C,t.element,r),T,re(C,t.element)];default:var z=e.attributes,I=e.children;e.element=n.nextElement++;for(var U=te(e.element,'m.ce("'+e.type+'");'),Z="",D=0;D<z.length;D++){var N=z[D],O=void 0;if("@"===N.key[0]){var R=void 0,j=void 0;if("@bind"===N.key){var F=ne(N);O=ee(e.element)+".value="+F+";",R="input",j=F+"=$event.target.value;instance.update();"}else O="",R=N.key.substring(1),j="locals.$event=$event;"+ne(N)+";";U+=(G=e.element,H=R,J="function($event){"+j+"}","m.ael("+ee(G)+',"'+H+'",'+J+");")}else M=e.element,S=N,O="m.sa("+ee(M)+',"'+S.key+'",'+ne(S)+");";N.dynamic?Z+=O:U+=O}for(var L=0;L<I.length;L++){var B=ae(I[L],e,n,null);U+=B[0],Z+=B[1]}return[U+oe(e.element,t.element,r),Z,re(e.element,t.element)]}var M,S,G,H,J,K,P,Q,V,W,X,Y},ue=function(e,t){for(var n=e.children,r="",i="",o="",a=0;a<n.length;a++){var u=ae(n[a],e,e,t);r+=u[0],i+=u[1],o+=u[2]}for(var s="var "+ee(e.element),l=e.element+1;l<e.nextElement;l++)s+=","+ee(l);return s+";return [function(_0){"+te(e.element,"_0;")+r+"},function(){"+i+"},function(){"+o+"}];"},o=function(e){return ue(function(e){for(var t=e.length,n={element:0,referenceElement:1,nextElement:2,type:"Root",attributes:[],children:[]},r=[n],i=0;i<t;){var o=e[i];i="<"===o?"!"===e[i+1]&&"-"===e[i+2]&&"-"===e[i+3]?s(i+4,e,t):"/"===e[i+1]?u(i+2,e,t,r):a(i+1,e,t,r):"{"===o?p(i+1,e,t,r):h(i,e,t,r)}return n}(e),null)},y={ce:function(e){return document.createElement(e)},ctn:function(e){return document.createTextNode(e)},cc:function(){return document.createComment("")},sa:function(e,t,n){e.setAttribute(t,n)},ael:function(e,t,n){e.addEventListener(t,n)},stc:function(e,t){e.textContent=t},ac:function(e,t){t.appendChild(e)},rc:function(e,t){t.removeChild(e)},ib:function(e,t,n){n.insertBefore(e,t)},di:function(e,t,n,r,i){for(var o=0;o<n.length;o++)if(n[o]){var a=r[o];return e===a?a[1]():(e&&e[2](),a[0](i,t),a[1](),e=a),e}},df:function(e,t,n,r,i,o,a){for(var u=i.length,s=t.length,l=s<u?u:s,c=e[1],f=e[0],v=0;v<l;v++)if(u<=v){var d={};d[c]=v,d[f]=t[v];var m=r(o[v]=d);i.push(m),m[0](a,n),m[1]()}else if(s<=v)i.pop()[2]();else{var h=o[v];h[c]=v,h[f]=t[v],i[v][1]()}}},b=function(e){this._view[0](e),this.emit("create")},x=function(e,t){if(void 0!==e)if("object"==typeof e)for(var n in e)this[n]=e[n];else this[e]=t;if(!1===this._queued){this._queued=!0;var r=this;setTimeout(function(){r._view[1](),r._queued=!1,r.emit("update")},0)}},g=function(){this._view[2](),this.emit("destroy")},E=function(e,t){var n=this._events,r=n[e];void 0===r?n[e]=[t]:r.push(t)},_=function(e,t){if(void 0===e)this._events={};else if(void 0===t)this._events[e]=[];else{var n=this._events[e];n.splice(n.indexOf(t),1)}},k=function(e,t){var n=this._events[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var r=0;r<n.length;r++)n[r](t)},i=function(r,i){return function(){this._name=r,this._queued=!1,"string"==typeof i.view?this._view=new Function("m","instance","locals",o(i.view))(y,this,{}):this._view=i.view(y,this,{}),delete i.view;var e={};for(var t in void 0!==i.onCreate&&(e.create=i.onCreate.bind(this),delete i.onCreate),void 0!==i.onUpdate&&(e.update=i.onUpdate.bind(this),delete i.onUpdate),void 0!==i.onDestroy&&(e.destroy=i.onDestroy.bind(this),delete i.onDestroy),this._events=e,void 0===i?i={}:"function"==typeof i&&(i=i()),i){var n=i[t];this[t]="function"==typeof n?n.bind(this):n}this.create=b,this.update=x,this.destroy=g,this.on=E,this.off=_,this.emit=k}};function n(e){var t=e.root;delete e.root,"string"==typeof t&&(t=document.querySelector(t));var n=new(i("",e));return n.create(t),n.update(),n}return n.extend=function(e,t){},n.compile=o,n.config=e,n});